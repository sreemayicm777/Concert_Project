<%- include('../partials/header') %>

<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1>Booking Details</h1>
    <a href="/bookings/my-bookings" class="btn btn-outline-secondary">
      <i class="fas fa-arrow-left"></i> Back to My Bookings
    </a>
  </div>

  <div class="card mb-4">
    <div class="card-header bg-primary text-white">
      <h5 class="mb-0">Booking #<%= booking._id %></h5>
    </div>
    <div class="card-body">
      <div class="row">
        <div class="col-md-6">
          <h5>Concert Information</h5>
          <div class="mb-3">
            <img src="<%= booking.concert.image || '/images/default-concert.jpg' %>" 
                 class="img-fluid rounded" 
                 alt="<%= booking.concert.name %>">
          </div>
          <h4><%= booking.concert.name %></h4>
          <% if (booking.concert.artist) { %>
            <p class="text-muted">by <%= booking.concert.artist %></p>
          <% } %>
          
          <ul class="list-group list-group-flush mb-3">
            <li class="list-group-item">
              <i class="fas fa-calendar-day me-2"></i>
              <strong>Date:</strong> 
              <%= moment(booking.concert.date).format('dddd, MMMM Do YYYY') %>
            </li>
            <li class="list-group-item">
              <i class="fas fa-map-marker-alt me-2"></i>
              <strong>Venue:</strong> <%= booking.concert.venue %>
            </li>
            <% if (booking.concert.description) { %>
              <li class="list-group-item">
                <i class="fas fa-info-circle me-2"></i>
                <strong>Details:</strong> <%= booking.concert.description %>
              </li>
            <% } %>
          </ul>
        </div>
        
        <div class="col-md-6">
          <h5>Booking Information</h5>
          <ul class="list-group list-group-flush mb-3">
            <li class="list-group-item">
              <i class="fas fa-ticket-alt me-2"></i>
              <strong>Tickets:</strong> <%= booking.tickets %>
            </li>
            <li class="list-group-item">
              <i class="fas fa-money-bill-wave me-2"></i>
              <strong>Price per ticket:</strong> $<%= booking.concert.ticketPrice.toFixed(2) %>
            </li>
            <li class="list-group-item">
              <i class="fas fa-calculator me-2"></i>
              <strong>Total:</strong> $<%= (booking.tickets * booking.concert.ticketPrice).toFixed(2) %>
            </li>
            <li class="list-group-item">
              <i class="fas fa-credit-card me-2"></i>
              <strong>Payment Method:</strong> 
              <%= booking.paymentMethod.replace('_', ' ').toUpperCase() %>
            </li>
            <li class="list-group-item">
              <i class="fas fa-check-circle me-2"></i>
              <strong>Payment Status:</strong> 
              <span class="badge bg-<%= booking.paymentStatus === 'completed' ? 'success' : 'warning' %>">
                <%= booking.paymentStatus.toUpperCase() %>
              </span>
            </li>
            <li class="list-group-item">
              <i class="fas fa-clock me-2"></i>
              <strong>Booked On:</strong> 
              <%= moment(booking.bookedAt).format('MMMM Do YYYY, h:mm a') %>
            </li>
            <li class="list-group-item">
              <i class="fas fa-info-circle me-2"></i>
              <strong>Status:</strong> 
              <span class="badge bg-<%= booking.status === 'confirmed' ? 'success' : 'danger' %>">
                <%= booking.status.toUpperCase() %>
              </span>
            </li>
          </ul>

          <% if (booking.status === 'confirmed') { %>
            <div class="d-grid gap-2">
              <button class="btn btn-outline-danger" id="cancelBookingBtn">
                <i class="fas fa-times-circle me-2"></i> Cancel Booking
              </button>
              <button class="btn btn-success" id="downloadTicketBtn">
                <i class="fas fa-download me-2"></i> Download Ticket
              </button>
            </div>
          <% } %>
        </div>
      </div>
    </div>
  </div>
</div>

<%- include('../partials/footer') %>

<script>
// Simple cancel booking functionality
document.getElementById('cancelBookingBtn')?.addEventListener('click', function() {
  if (confirm('Are you sure you want to cancel this booking?')) {
    // In a real app, you would make an API call here
    alert('Booking cancellation would be processed here');
    // window.location.href = `/bookings/${booking._id}/cancel`;
  }
});

// PDF download functionality
document.getElementById('downloadTicketBtn')?.addEventListener('click', function() {
  alert('Ticket PDF would be generated here');
  // window.location.href = `/bookings/${booking._id}/ticket`;
});
</script>